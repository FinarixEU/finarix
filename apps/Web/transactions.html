<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<title>Konten & Transaktionen – Finarix</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:system-ui,Arial;margin:40px}
input,select,button{margin:4px;padding:8px}
table{width:100%;border-collapse:collapse;margin-top:20px;background:#fafafa}
th,td{border:1px solid #ddd;padding:8px;text-align:left}
</style>
</head>

<body>
<h2>Konten & Transaktionen</h2>

<!-- Konto anlegen -->
<input id="accName" placeholder="Kontoname">
<input id="accType" placeholder="Typ (bank/cash)">
<button onclick="createAccount()">Konto anlegen</button>

<br>

<!-- Transaktion -->
<select id="transAcc"></select>
<input id="amount" type="number" step="0.01" value="0.00">
<input id="desc" placeholder="Beschreibung">
<button onclick="addTransaction()">+ Transaktion</button>

<button onclick="loadAll()">Neu laden</button>
<button onclick="logout()">Logout</button>

<table>
<thead>
<tr>
<th>Datum</th><th>Konto</th><th>Betrag</th><th>Text</th>
</tr>
</thead>
<tbody id="rows"><tr><td colspan="4">Lade…</td></tr></tbody>
</table>

<p><a href="./profile.html">← Zurück</a></p>

<script src="./js/api.js"></script>
<script>
async function loadAccounts(){
  const accounts = await apiFetch('/accounts');
  const sel = document.getElementById('transAcc');
  sel.innerHTML = accounts.map(a=>`<option value="${a.id}">${a.name}</option>`).join('');
}

async function loadTransactions(){
  const tx = await apiFetch('/transactions');
  const rows = document.getElementById('rows');
  if(!tx.length){
    rows.innerHTML = `<tr><td colspan="4">Keine Daten</td></tr>`;
    return;
  }
  rows.innerHTML = tx.map(t=>`
    <tr>
      <td>${new Date(t.date).toLocaleString()}</td>
      <td>${t.account.name}</td>
      <td>${t.amount}</td>
      <td>${t.description ?? ''}</td>
    </tr>
  `).join('');
}

async function createAccount(){
  await apiFetch('/accounts', {
    method: 'POST',
    body:{name:accName.value, type:accType.value}
  });
  loadAll();
}

async function addTransaction(){
  await apiFetch('/transactions', {
    method: 'POST',
    body:{
      accountId:Number(transAcc.value),
      amount:Number(amount.value),
      description:desc.value
    }
  });
  loadAll();
}

function logout(){
  localStorage.removeItem('token');
  location.href='./login.html';
}

function loadAll(){
  loadAccounts();
  loadTransactions();
}

loadAll();
</script>

</body>
</html>
